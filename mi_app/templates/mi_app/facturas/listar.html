{% extends "mi_app/base.html" %}

{% block title %}Facturas{% endblock %}

{% block content %}
<h1>Facturas</h1>

<a href="{% url 'dashboard' %}" class="btn">â† Volver</a>

<hr>

<!-- ===== TABLA (DESKTOP) ===== -->
<div class="tabla-facturas">
<table>
    <thead>
        <tr>
            <th>NÃºmero</th>
            <th>Cliente</th>
            <th>Estado</th>
            <th class="monto">Total</th>
            <th>Fecha</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for factura in facturas %}
        <tr>
            <td>{{ factura.numero|default:"â€”" }}</td>
            <td>{{ factura.cliente.nombre }}</td>
            <td>{{ factura.get_estado_display }}</td>
            <td class="monto">${{ factura.total }}</td>
            <td class="fecha">{{ factura.creada|date:"d/m/Y H:i" }}</td>
            <td>
                <a href="{% url 'detalle_factura' factura.id %}">Ver</a>

                {% if factura.estado == 'borrador' %}
                    <form method="post"
                          action="{% url 'borrar_borrador' factura.id %}"
                          style="display:inline;"
                          onsubmit="return confirm('Â¿Seguro que deseas eliminar este borrador?');">
                        {% csrf_token %}
                        <button type="submit" class="btn-borrar">ğŸ—‘</button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">No hay facturas</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<!-- ===== CARDS (MOBILE) ===== -->
<div class="facturas-cards">
    {% for factura in facturas %}
    <div class="factura-card">
        <div class="fila">
            <span class="label">NÃºmero</span>
            <span class="valor">{{ factura.numero|default:"â€”" }}</span>
        </div>

        <div class="fila">
            <span class="label">Cliente</span>
            <span class="valor">{{ factura.cliente.nombre }}</span>
        </div>

        <div class="fila">
            <span class="label">Estado</span>
            <span class="valor">{{ factura.get_estado_display }}</span>
        </div>

        <div class="fila">
            <span class="label">Total</span>
            <span class="valor monto">${{ factura.total }}</span>
        </div>

        <div class="fila">
            <span class="label">Fecha</span>
            <span class="valor">{{ factura.creada|date:"d/m/Y H:i" }}</span>
        </div>

        <div class="acciones">
            <a href="{% url 'detalle_factura' factura.id %}" class="ver">
                Ver factura
            </a>

            {% if factura.estado == 'borrador' %}
                <form method="post"
                      action="{% url 'borrar_borrador' factura.id %}"
                      onsubmit="return confirm('Â¿Seguro que deseas eliminar este borrador?');">
                    {% csrf_token %}
                    <button type="submit" class="btn-borrar">
                        ğŸ—‘ Borrar
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <p>No hay facturas</p>
    {% endfor %}
</div>

{% endblock %}
